<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¶å¯å¤¢éš¨æ©Ÿå°æˆ°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body {
            background-color: #f3f4f6;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .pixel-font {
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
        }

        .hp-bar-bg {
            height: 12px;
            background-color: #e5e7eb;
            border-radius: 6px;
            overflow: hidden;
            border: 2px solid #374151;
        }

        .hp-bar-fill {
            height: 100%;
            transition: width 0.5s ease-out, background-color 0.3s;
        }

        .battle-bg {
            background: linear-gradient(to bottom, #87CEEB 0%, #87CEEB 60%, #90EE90 60%, #90EE90 100%);
            border: 4px solid #374151;
            position: relative;
            overflow: hidden;
        }

        .pokemon-sprite {
            width: 120px;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
        }

        .log-container::-webkit-scrollbar {
            width: 6px;
        }
        .log-container::-webkit-scrollbar-thumb {
            background: #9ca3af;
            border-radius: 3px;
        }
        
        /* å‹•ç•«æ•ˆæœ */
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        .damaged {
            animation: shake 0.5s;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-2xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden border-4 border-gray-800">
        <!-- é ‚éƒ¨æ¨™é¡Œ -->
        <div class="bg-gray-800 text-white p-4 flex justify-between items-center">
            <h1 class="text-xl font-bold tracking-widest">POKÃ‰MON RANDOM BATTLE</h1>
            <div id="turn-indicator" class="px-3 py-1 bg-yellow-500 text-black text-xs font-bold rounded">æº–å‚™ä¸­</div>
        </div>

        <!-- å°æˆ°ç•«é¢å€ -->
        <div class="battle-bg h-64 flex flex-col justify-between p-6">
            <!-- å°æ‰‹å¯¶å¯å¤¢ (å³ä¸Šæ–¹) -->
            <div class="flex justify-end items-start gap-4">
                <div id="opponent-info" class="bg-white/90 p-2 rounded-lg border-2 border-gray-700 w-48 shadow-md">
                    <div class="flex justify-between items-end mb-1">
                        <span id="enemy-name" class="font-bold text-sm">???</span>
                        <span class="text-xs">Lv.50</span>
                    </div>
                    <div class="hp-bar-bg">
                        <div id="enemy-hp-bar" class="hp-bar-fill w-full bg-green-500"></div>
                    </div>
                    <div class="text-right text-[10px] mt-1 font-mono" id="enemy-hp-text">100/100</div>
                </div>
                <div id="enemy-sprite" class="pokemon-sprite">â“</div>
            </div>

            <!-- ç©å®¶å¯¶å¯å¤¢ (å·¦ä¸‹æ–¹) -->
            <div class="flex justify-start items-end gap-4">
                <div id="player-sprite" class="pokemon-sprite">â“</div>
                <div id="player-info" class="bg-white/90 p-2 rounded-lg border-2 border-gray-700 w-48 shadow-md">
                    <div class="flex justify-between items-end mb-1">
                        <span id="player-name" class="font-bold text-sm">???</span>
                        <span class="text-xs">Lv.50</span>
                    </div>
                    <div class="hp-bar-bg">
                        <div id="player-hp-bar" class="hp-bar-fill w-full bg-green-500"></div>
                    </div>
                    <div class="text-right text-[10px] mt-1 font-mono" id="player-hp-text">100/100</div>
                </div>
            </div>
        </div>

        <!-- å°æˆ°æ—¥èªŒ & æ§åˆ¶å€ -->
        <div class="grid grid-cols-1 md:grid-cols-2 h-48 border-t-4 border-gray-800">
            <!-- æ—¥èªŒå€ -->
            <div id="battle-log" class="log-container p-4 bg-gray-50 overflow-y-auto text-sm space-y-1 border-r-0 md:border-r-4 border-gray-800">
                <p class="text-gray-500 italic">æ­¡è¿ä¾†åˆ°éš¨æ©Ÿå°æˆ°ï¼é»æ“Šã€Œé–‹å§‹å°æˆ°ã€ï¼</p>
            </div>

            <!-- æŒ‰éˆ•å€ -->
            <div id="controls" class="p-4 bg-white grid grid-cols-2 gap-2">
                <button onclick="initGame()" id="start-btn" class="col-span-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded shadow-lg transition">
                    é–‹å§‹å°æˆ°
                </button>
                <div id="move-buttons" class="contents hidden">
                    <!-- æ‹›å¼å°‡ç”± JS ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // æ•¸æ“šå®šç¾©
        const POKEMONS = [
            { name: "å™´ç«é¾", type: "fire", emoji: "ğŸ”¥", hp: 156, moves: ["å™´å°„ç«ç„°", "é¾ä¹‹æ³¢å‹•", "æ–¬æ“Š", "ç†±é¢¨"] },
            { name: "æ°´ç®­é¾œ", type: "water", emoji: "ğŸ¢", hp: 162, moves: ["åŠ è¾²æ°´ç‚®", "æƒ¡ä¹‹æ³¢å‹•", "æ°´æ³¢åˆ€", "ç¸®å…¥æ®¼ä¸­"] },
            { name: "å¦™è›™èŠ±", type: "grass", emoji: "ğŸŒº", hp: 160, moves: ["ç˜‹ç‹‚æ¤ç‰©", "æ±¡æ³¥ç‚¸å½ˆ", "å¯„ç”Ÿç¨®å­", "èƒ½é‡çƒ"] },
            { name: "çš®å¡ä¸˜", type: "electric", emoji: "âš¡", hp: 120, moves: ["åè¬ä¼ç‰¹", "éµå°¾", "é›»å…‰ä¸€é–ƒ", "æ‰“é›·"] },
            { name: "è€¿é¬¼", type: "ghost", emoji: "ğŸ‘»", hp: 140, moves: ["æš—å½±çƒ", "æ±¡æ³¥ç‚¸å½ˆ", "ç¦ä¸å–®è¡Œ", "å‚¬çœ è¡“"] },
            { name: "å¿«é¾", type: "dragon", emoji: "ğŸ²", hp: 170, moves: ["é€†é±—", "ç¥é€Ÿ", "ç«ç„°æ‹³", "æš´é¢¨"] }
        ];

        const MOVES = {
            "å™´å°„ç«ç„°": { power: 90, type: "fire" },
            "ç†±é¢¨": { power: 95, type: "fire" },
            "åŠ è¾²æ°´ç‚®": { power: 100, type: "water" },
            "æ°´æ³¢åˆ€": { power: 70, type: "water" },
            "ç˜‹ç‹‚æ¤ç‰©": { power: 100, type: "grass" },
            "èƒ½é‡çƒ": { power: 80, type: "grass" },
            "åè¬ä¼ç‰¹": { power: 90, type: "electric" },
            "æ‰“é›·": { power: 110, type: "electric" },
            "æš—å½±çƒ": { power: 80, type: "ghost" },
            "æ±¡æ³¥ç‚¸å½ˆ": { power: 90, type: "poison" },
            "é€†é±—": { power: 120, type: "dragon" },
            "ç¥é€Ÿ": { power: 80, type: "normal" },
            "æ–¬æ“Š": { power: 70, type: "normal" },
            "é›»å…‰ä¸€é–ƒ": { power: 40, type: "normal" },
            "éµå°¾": { power: 100, type: "steel" },
            "é¾ä¹‹æ³¢å‹•": { power: 85, type: "dragon" },
            "æƒ¡ä¹‹æ³¢å‹•": { power: 80, type: "dark" },
            "ç¦ä¸å–®è¡Œ": { power: 65, type: "ghost" },
            "å¯„ç”Ÿç¨®å­": { power: 0, effect: "heal", value: 20 },
            "ç¸®å…¥æ®¼ä¸­": { power: 0, effect: "buff", value: 1.5 },
            "å‚¬çœ è¡“": { power: 0, effect: "status", status: "sleep" },
            "ç«ç„°æ‹³": { power: 75, type: "fire" },
            "æš´é¢¨": { power: 110, type: "flying" }
        };

        const TYPE_CHART = {
            fire: { grass: 2, water: 0.5, fire: 0.5 },
            water: { fire: 2, grass: 0.5, water: 0.5 },
            grass: { water: 2, fire: 0.5, grass: 0.5 },
            electric: { water: 2, grass: 1, fire: 1 },
            dragon: { dragon: 2 }
        };

        // éŠæˆ²ç‹€æ…‹
        let gameState = {
            player: null,
            enemy: null,
            isPlayerTurn: true,
            gameOver: false,
            busy: false
        };

        const logEl = document.getElementById('battle-log');

        function addLog(msg, type = 'normal') {
            const p = document.createElement('p');
            if (type === 'critical') p.className = 'text-red-600 font-bold';
            if (type === 'system') p.className = 'text-blue-600 font-bold';
            if (type === 'enemy') p.className = 'text-orange-600';
            p.innerText = msg;
            logEl.appendChild(p);
            logEl.scrollTop = logEl.scrollHeight;
        }

        function initGame() {
            logEl.innerHTML = "";
            gameState.gameOver = false;
            gameState.busy = false;
            
            // éš¨æ©Ÿé¸å–å¯¶å¯å¤¢
            const pIndex = Math.floor(Math.random() * POKEMONS.length);
            let eIndex = Math.floor(Math.random() * POKEMONS.length);
            
            gameState.player = { ...POKEMONS[pIndex], currentHp: POKEMONS[pIndex].hp, maxHp: POKEMONS[pIndex].hp };
            gameState.enemy = { ...POKEMONS[eIndex], currentHp: POKEMONS[eIndex].hp, maxHp: POKEMONS[eIndex].hp };

            // æ›´æ–° UI
            document.getElementById('player-name').innerText = gameState.player.name;
            document.getElementById('enemy-name').innerText = gameState.enemy.name;
            document.getElementById('player-sprite').innerText = gameState.player.emoji;
            document.getElementById('enemy-sprite').innerText = gameState.enemy.emoji;
            
            updateHpUI();

            // é¡¯ç¤ºæ‹›å¼æŒ‰éˆ•
            document.getElementById('start-btn').classList.add('hidden');
            const moveContainer = document.getElementById('move-buttons');
            moveContainer.classList.remove('hidden');
            moveContainer.innerHTML = "";
            
            gameState.player.moves.forEach(moveName => {
                const btn = document.createElement('button');
                btn.className = "bg-gray-100 hover:bg-gray-200 border-2 border-gray-400 p-2 rounded text-xs font-bold transition active:scale-95";
                btn.innerText = moveName;
                btn.onclick = () => handlePlayerMove(moveName);
                moveContainer.appendChild(btn);
            });

            addLog(`é‡ç”Ÿçš„ ${gameState.enemy.name} å‡ºç¾äº†ï¼`, 'system');
            addLog(`å°±æ±ºå®šæ˜¯ä½ äº†ï¼Œ${gameState.player.name}ï¼`, 'system');
            
            setTurn(true);
        }

        function setTurn(isPlayer) {
            gameState.isPlayerTurn = isPlayer;
            const indicator = document.getElementById('turn-indicator');
            if (isPlayer) {
                indicator.innerText = "ä½ çš„å›åˆ";
                indicator.className = "px-3 py-1 bg-green-500 text-white text-xs font-bold rounded";
            } else {
                indicator.innerText = "å°æ–¹å›åˆ";
                indicator.className = "px-3 py-1 bg-red-500 text-white text-xs font-bold rounded";
            }
        }

        function updateHpUI() {
            const pPercent = (gameState.player.currentHp / gameState.player.maxHp) * 100;
            const ePercent = (gameState.enemy.currentHp / gameState.enemy.maxHp) * 100;

            const pBar = document.getElementById('player-hp-bar');
            const eBar = document.getElementById('enemy-hp-bar');

            pBar.style.width = `${Math.max(0, pPercent)}%`;
            eBar.style.width = `${Math.max(0, ePercent)}%`;

            // è®Šè‰²é‚è¼¯
            pBar.style.backgroundColor = pPercent < 20 ? '#ef4444' : pPercent < 50 ? '#f59e0b' : '#22c55e';
            eBar.style.backgroundColor = ePercent < 20 ? '#ef4444' : ePercent < 50 ? '#f59e0b' : '#22c55e';

            document.getElementById('player-hp-text').innerText = `${Math.ceil(gameState.player.currentHp)}/${gameState.player.maxHp}`;
            document.getElementById('enemy-hp-text').innerText = `${Math.ceil(gameState.enemy.currentHp)}/${gameState.enemy.maxHp}`;
        }

        async function handlePlayerMove(moveName) {
            if (!gameState.isPlayerTurn || gameState.gameOver || gameState.busy) return;
            
            gameState.busy = true;
            await executeMove(gameState.player, gameState.enemy, moveName, true);
            
            if (!gameState.gameOver) {
                setTurn(false);
                setTimeout(enemyTurn, 1500);
            }
        }

        async function enemyTurn() {
            const randomMove = gameState.enemy.moves[Math.floor(Math.random() * gameState.enemy.moves.length)];
            await executeMove(gameState.enemy, gameState.player, randomMove, false);
            
            if (!gameState.gameOver) {
                setTurn(true);
                gameState.busy = false;
            }
        }

        async function executeMove(attacker, defender, moveName, isPlayer) {
            const move = MOVES[moveName];
            addLog(`${attacker.name} ä½¿ç”¨äº† ${moveName}ï¼`, isPlayer ? 'normal' : 'enemy');

            if (move.power > 0) {
                // å‚·å®³è¨ˆç®—
                let multiplier = 1;
                if (TYPE_CHART[move.type] && TYPE_CHART[move.type][defender.type]) {
                    multiplier = TYPE_CHART[move.type][defender.type];
                }

                const baseDamage = (move.power / 5) + (Math.random() * 5);
                const finalDamage = Math.floor(baseDamage * multiplier);
                
                // å‹•ç•«ï¼šå—æ“Šé–ƒçˆ
                const targetSpriteId = isPlayer ? 'enemy-sprite' : 'player-sprite';
                document.getElementById(targetSpriteId).classList.add('damaged');
                setTimeout(() => document.getElementById(targetSpriteId).classList.remove('damaged'), 500);

                defender.currentHp -= finalDamage;
                if (defender.currentHp < 0) defender.currentHp = 0;

                updateHpUI();

                if (multiplier > 1) addLog("æ•ˆæœçµ•ä½³ï¼", 'critical');
                if (multiplier < 1) addLog("æ•ˆæœä¸ç†æƒ³...");
            } else {
                // è¼”åŠ©æŠ€èƒ½ç°¡å–®è™•ç†
                if (move.effect === 'heal') {
                    attacker.currentHp = Math.min(attacker.maxHp, attacker.currentHp + move.value);
                    updateHpUI();
                    addLog(`${attacker.name} å›å¾©äº† HPï¼`);
                } else {
                    addLog("ä½†ä»€éº¼éƒ½æ²’æœ‰ç™¼ç”Ÿ...");
                }
            }

            // æª¢æŸ¥å‹è² 
            if (defender.currentHp <= 0) {
                gameState.gameOver = true;
                addLog(`${defender.name} å€’ä¸‹äº†ï¼`, 'system');
                addLog(isPlayer ? "ä½ è´å¾—äº†æˆ°é¬¥ï¼" : "ä½ è¼¸äº†ï¼Œè«‹å†æ¥å†å²ã€‚", 'system');
                
                document.getElementById('move-buttons').classList.add('hidden');
                document.getElementById('start-btn').classList.remove('hidden');
                document.getElementById('start-btn').innerText = "å†ç©ä¸€æ¬¡";
            }

            return new Promise(res => setTimeout(res, 800));
        }
    </script>
</body>
</html>
